// 太极功
new entry "Passive_KFC_TaiJiQuan"
type "PassiveData"
// 武艺：附赠徒手打击
data "Icon" "PassiveFeature_MartialArts_BonusUnarmedStrike"
data "DisplayName" "hbf516c35gaed3g48dfgb6b0g5df4a1b9315c;1"
data "Description" "h846722bag6b61g4b9fgac2agd4670d0f76eb;1"
data "Properties" "Highlighted"
data "Boosts" "ActionResource(ReactionActionPoint,1,0);ActionResource(SuperiorityDie,2,0);UnlockInterrupt(Interrupt_KFC_Riposte);UnlockSpell(Target_KFC_Shove)"

// 太极拳 (反击)
new entry "Interrupt_KFC_Riposte"
type "InterruptData"
data "Icon" "Action_Monk_OpenHandTechnique_Knock"
data "DisplayName" "ha0112a84gdffdg4db7g8d21g5b9c88ac904e;1"
data "Description" "hea0b19beg0157g44ddgac81g9beb70e4f73f;1"
data "DescriptionParams" "DealDamage(max(1,UnarmedDamage)+max(1,StrengthModifier)+max(1,DexterityModifier)+LevelMapValue(SuperiorityDie)+LevelMapValue(MartialArts),Bludgeoning);17;1"
data "ExtraDescription" "h8cc06fc1gb0b0g4ffdga030gfe5ecdbbfe2f;1"
data "InterruptContext" "OnCastHit"
data "InterruptContextScope" "Self"
data "Container" "YesNoDecision"
// 允许反应、是敌人、不是物品、触发攻击、是近战、距离2以内、未隐身
data "Conditions" "IsAbleToReact(context.Observer) and Enemy(context.Source,context.Observer) and not AnyEntityIsItem() and HasLastAttackTriggered() and IsMeleeAttack() and not DistanceToEntityGreaterThan(2,context.ObserverPosition,context.Source) and not HasStatus('INVISIBILITY')"
data "Properties" "UseSpell(SWAP,Target_KFC_Riposte,true,true,true);ApplyStatus(OBSERVER_OBSERVER,KFC_INTERRUPT_RIPOSTE,100,0)"
data "Cost" "ReactionActionPoint:1"
data "InterruptDefaultValue" "Enabled"
data "EnableCondition" "not HasStatus('SG_Polymorph') or Tagged('MINDFLAYER') or HasStatus('SG_Disguise')"
data "EnableContext" "OnStatusApplied;OnStatusRemoved"

new entry "KFC_INTERRUPT_RIPOSTE"
type "StatusData"
data "StatusType" "EFFECT"
data "DisplayName" "ha0112a84gdffdg4db7g8d21g5b9c88ac904e;1"
data "StatusPropertyFlags" "DisableOverhead;DisableCombatlog;DisablePortraitIndicator"
data "StatusEffect" "ec81657b-9e78-49d9-83a0-47a7ad2a1753"

new entry "Target_KFC_Riposte"
type "SpellData"
data "SpellType" "Target"
data "TargetCeiling" "0"
data "TargetFloor" ".25"
data "TargetRadius" "1.5"
data "SpellRoll" "Attack(AttackType.MeleeUnarmedAttack);Cast2[Attack(AttackType.MeleeUnarmedAttack)]"
data "TargetConditions" "Character() and not Self() and not Dead()"
data "CycleConditions" "Character() and not Self() and not Dead()"
data "Icon" "Action_Monk_OpenHandTechnique_Knock"
data "DisplayName" "ha0112a84gdffdg4db7g8d21g5b9c88ac904e;1"
data "Description" "hea0b19beg0157g44ddgac81g9beb70e4f73f;1"
data "DescriptionParams" "DealDamage(max(1,UnarmedDamage)+max(1,StrengthModifier)+max(1,DexterityModifier)+LevelMapValue(SuperiorityDie)+LevelMapValue(MartialArts),Bludgeoning);17;1"
data "ExtraDescription" "h8cc06fc1gb0b0g4ffdga030gfe5ecdbbfe2f;1"
data "TooltipDamageList" "DealDamage(max(1,UnarmedDamage)+max(1,StrengthModifier)+max(1,DexterityModifier)+LevelMapValue(SuperiorityDie)+LevelMapValue(MartialArts),Bludgeoning);DealDamage(max(1,UnarmedDamage)+max(1,StrengthModifier)+max(1,DexterityModifier)+LevelMapValue(SuperiorityDie)+LevelMapValue(MartialArts),Bludgeoning)"
data "SpellSuccess" "IF(not Ally()):Force(ShoveDistance,OriginToEntity,Aggressive);IF(Ally()):Force(ShoveDistance,OriginToEntity,Friendly);DealDamage(max(1,UnarmedDamage)+max(1,StrengthModifier)+max(1,DexterityModifier)+LevelMapValue(SuperiorityDie)+LevelMapValue(MartialArts),Bludgeoning);Cast2[DealDamage(max(1,UnarmedDamage)+max(1,StrengthModifier)+max(1,DexterityModifier)+LevelMapValue(SuperiorityDie)+LevelMapValue(MartialArts),Bludgeoning)];IF(not SavingThrow(Ability.Dexterity,17)):ApplyStatus(PRONE,100,1)"
data "TooltipAttackSave" "MeleeUnarmedAttack"
data "PreviewCursor" "Melee"
data "CastTextEvent" "Cast"
data "PrepareSound" "Vocal_Component_Monk_Damage"
data "CastSound" "Spell_Cast_Monk_FlurryofBlows_L1to3"
data "AlternativeCastTextEvents" "Cast2"
data "HitCosts" "SuperiorityDie:2"
data "SpellAnimation" "26fe0848-ce88-41c7-8184-4e405936cfd1,,;bb71ceb0-5636-40c6-8af3-eb6d98bcf5a4,,;4595e579-0b44-498f-8eb4-26375b9fe9fb,,;4fe5d677-2411-4e63-bfa1-bb449f7c6942,,;284c7d71-e6b8-4026-8b8f-f4a5da2e3183,,;c50242af-8b22-4f9f-a890-cd8e58b3ff70,,;0b07883a-08b8-43b6-ac18-84dc9e84ff50,,;,,;,,"
data "VerbalIntent" "Damage"
data "SpellStyleGroup" "Class"
data "SpellFlags" "IsMelee;IsHarmful;DisableBlood"
data "HitAnimationType" "PhysicalDamage"
data "SpellAnimationIntentType" "Aggressive"
data "PrepareEffect" "85386181-e9ec-4996-a1dd-7f09f3013189"
data "CastEffect" "208b02ef-5847-493d-94b8-a901691979ef"
data "TargetEffect" "82b8aad9-5031-41f8-a871-dc55eb52af88"
data "DamageType" "Bludgeoning"
data "SpellSoundMagnitude" "None"
data "Sheathing" "Sheathed"
data "InterruptPrototype" "Interrupt_KFC_Riposte"

new entry "Target_KFC_Shove"
type "SpellData"
data "SpellType" "Target"
using "Target_KFC_Riposte"
data "Icon" "Action_Monk_OpenHandTechnique_Knock"
data "DisplayName" "ha0112a84gdffdg4db7g8d21g5b9c88ac904e;1"
data "Description" "h63e40bd7ge61dg429cgbc1fgcc223f1e0239;1"
data "UseCosts" "ActionPoint:1"
data "InterruptPrototype" ""

// 斗转星移 (拨挡飞弹)
new entry "Passive_KFC_DouZhuanXingYi"
type "PassiveData"
// 拨挡飞弹
data "Icon" "PassiveFeature_DeflectMissiles"
data "DisplayName" "h6ae8a09bg7750g41b1gaa7ege85ab323c667;1"
data "Description" "hee24ba29ge538g4118gba17g4cb68f1d067c;1"
data "Properties" "Highlighted"
data "Boosts" "ActionResource(ReactionActionPoint,1,0);ActionResource(SuperiorityDie,1,0);UnlockInterrupt(Interrupt_KFC_DeflectMissiles);UnlockInterrupt(Interrupt_KFC_DeflectMissiles_Return)"
data "StatsFunctorContext" "OnCreate;OnLongRest"
data "StatsFunctors" "UseActionResource(KFC_DeflectMissiles_Charge,1,0)"

new entry "Interrupt_KFC_DeflectMissiles"
type "InterruptData"
// 拨挡飞弹
data "Icon" "PassiveFeature_DeflectMissiles"
data "DisplayName" "h6ae8a09bg7750g41b1gaa7ege85ab323c667;1"
data "Description" "h5b9ecc36gc9efg42aagbfd5g1598246af4d5;1"
data "DescriptionParams" "Level+DexterityModifier+LevelMapValue(MartialArts);DealDamage(UnarmedDamage+LevelMapValue(SuperiorityDie),Bludgeoning)"
data "ExtraDescription" "h9a5ca2b6g288bg4c88gb0d5g1009e127b40b;1"
data "InterruptContext" "OnPreDamage"
data "InterruptContextScope" "Self"
data "Container" "YesNoDecision"
// 允许反应、是自己、不是物品、是远程
data "Conditions" "IsAbleToReact(context.Observer) and Self(context.Target,context.Observer) and not AnyEntityIsItem() and IsRangedAttack()"
data "Properties" "AdjustRoll(OBSERVER_OBSERVER,-(Level+DexterityModifier+LevelMapValue(MartialArts)));ApplyStatus(OBSERVER_TARGET,KFC_INTERRUPT_DEFLECT_MISSILES_HIT,100,1);RestoreResource(KFC_DeflectMissiles_Charge,1,0)"
data "Cost" "ReactionActionPoint:1"
data "InterruptDefaultValue" "Ask;Enabled"
data "EnableCondition" "not HasStatus('SG_Polymorph') or Tagged('MINDFLAYER') or HasStatus('SG_Disguise')"
data "EnableContext" "OnStatusApplied;OnStatusRemoved"

new entry "Shout_KFC_DeflectMissiles"
type "SpellData"
data "SpellType" "Shout"
// 拨挡飞弹
data "Icon" "PassiveFeature_DeflectMissiles"
data "DisplayName" "h6ae8a09bg7750g41b1gaa7ege85ab323c667;1"
data "Description" "h5b9ecc36gc9efg42aagbfd5g1598246af4d5;1"
data "DescriptionParams" "Level+DexterityModifier+LevelMapValue(MartialArts);DealDamage(UnarmedDamage+LevelMapValue(SuperiorityDie),Bludgeoning)"
data "ExtraDescription" "h9a5ca2b6g288bg4c88gb0d5g1009e127b40b;1"
data "TooltipStatusApply" "RestoreResource(KFC_DeflectMissiles_Charge,1,0)"
data "CastTextEvent" "Cast"
data "VerbalIntent" "Utility"
data "InterruptPrototype" "Interrupt_KFC_DeflectMissiles"

new entry "Interrupt_KFC_DeflectMissiles_Return"
type "InterruptData"
// 拨挡飞弹
data "Icon" "PassiveFeature_DeflectMissiles"
data "DisplayName" "h6ae8a09bg7750g41b1gaa7ege85ab323c667;1"
data "Description" "hf330a78bga831g4cc5g9e01g100d39828039;1"
data "InterruptContext" "OnCastHit"
data "InterruptContextScope" "Self"
data "Container" "YesNoDecision"
// 允许反应、是自己、不是物品、是远程、命中、有资源
data "Conditions" "IsAbleToReact(context.Observer) and Self(context.Target,context.Observer) and not AnyEntityIsItem() and IsRangedAttack() and not (IsCriticalMiss() or IsMiss()) and HasActionResource('KFC_DeflectMissiles_Charge',1,0,false,false,context.Observer)"
data "Properties" "UseSpell(SWAP,Projectile_KFC_Deflect_Missiles_Return",true,true,true,99636a80-29ec-4a19-a905-e0d30825c3e0);UseActionResource(OBSERVER_OBSERVER,KFC_DeflectMissiles_Charge,1,0)"
data "Cost" ""
data "InterruptDefaultValue" "Ask;Enabled"
data "EnableCondition" "not HasStatus('SG_Polymorph') or Tagged('MINDFLAYER') or HasStatus('SG_Disguise')"
data "EnableContext" "OnStatusApplied;OnStatusRemoved"

new entry "Projectile_KFC_Deflect_Missiles_Return"
type "SpellData"
data "SpellType" "Projectile"
data "TargetFloor" "-1"
data "TargetRadius" "30"
data "SpellRoll" "Attack(AttackType.MeleeUnarmedAttack)"
data "ProjectileCount" "1"
data "Trajectories" "e5f96de3-7ad6-4478-b2a6-b942e15bb71c"
// 拨挡飞弹
data "Icon" "PassiveFeature_DeflectMissiles"
data "DisplayName" "h6ae8a09bg7750g41b1gaa7ege85ab323c667;1"
data "Description" "hf330a78bga831g4cc5g9e01g100d39828039;1"
data "DescriptionParams" "DealDamage(UnarmedDamage+LevelMapValue(SuperiorityDie)+LevelMapValue(MartialArts),Bludgeoning)"
data "SpellProperties" "GROUND:DealDamage(UnarmedDamage+LevelMapValue(SuperiorityDie)+LevelMapValue(MartialArts),Bludgeoning)"
data "SpellSuccess" "DealDamage(UnarmedDamage+LevelMapValue(SuperiorityDie)+LevelMapValue(MartialArts),Bludgeoning)"
data "TooltipDamageList" "DealDamage(UnarmedDamage+LevelMapValue(SuperiorityDie)+LevelMapValue(MartialArts),Bludgeoning)"
data "HitCosts" "SuperiorityDie:1"
data "CastSound" "Action_Cast_Monk_DeflectMissile"
data "CastTextEvent" "Cast"
data "SpellAnimation" "8b8bb757-21ce-4e02-a2f3-97d55cf2f90b,,;,,;c3340bf4-833e-4c4d-b679-8ccdb26c30e7,,;6c5e8729-472f-4aab-acc4-a51d6657a50d,,;7bb52cd4-0b1c-4926-9165-fa92b75876a3,,;,,;0b07883a-08b8-43b6-ac18-84dc9e84ff50,,;,,;,,"
data "VerbalIntent" "Utility"
data "SpellFlags" "IsAttack;IsHarmful"
data "PrepareEffect" "5f319816-74c9-484c-9b27-5a25077ea126"
data "CastEffect" "8bfd5bf7-cb91-49f4-a9c4-b26a477e9299"

new entry "KFC_INTERRUPT_DEFLECT_MISSILES_HIT"
type "StatusData"
data "StatusType" "EFFECT"
data "DisplayName" "h6ae8a09bg7750g41b1gaa7ege85ab323c667;1"
data "StatusPropertyFlags" "DisableOverhead;DisableCombatlog;DisablePortraitIndicator"
data "StatusEffect" "b0ceab9b-5cdc-4436-ba89-832763900d72"

// 乾坤大挪移 (法术反制)
new entry "Passive_KFC_QianKunDaNuoYi"
type "PassiveData"
// 法术反制
data "Icon" "PassiveFeature_Counterspell"
data "DisplayName" "h86d88fd1g5817g4239gae61gdc97ceabc9a8;1"
data "Description" "h308cec68gda29g40e5gae76g5f53aa842295;1"
data "ExtraDescription" "he57bf83egac0cg46dfga37ag7474c1550ff2;1"
data "ExtraDescriptionParams" "Distance(18)"
data "Properties" "Highlighted"
data "Boosts" "ActionResource(ReactionActionPoint,2,0);UnlockInterrupt(Interrupt_KFC_Counterspell)"

new entry "Interrupt_KFC_Counterspell"
type "InterruptData"
// 灵能统御
data "Icon" "TadpoleSuperPower_PsionicDominance"
data "DisplayName" "h86d88fd1g5817g4239gae61gdc97ceabc9a8;1"
data "Description" "he57bf83egac0cg46dfga37ag7474c1550ff2;1"
data "DescriptionParams" "Distance(18)"
data "InterruptContext" "OnSpellCast"
data "InterruptContextScope" "Nearby"
data "Container" "YesNoDecision"
// 允许反应、未禁用、未被沉默、是敌人、非自己、不是物品、是法术、非武器攻击、法术等级小于等于熟练度判断
data "Conditions" "IsAbleToReact(context.Observer) and not Uninterruptible() and not HasSpellCastBlocked(context.Observer) and Enemy(context.Source,context.Observer) and not Self(context.Source,context.Observer) and not AnyEntityIsItem() and IsSpell() and not HasStringInSpellRoll('WeaponAttack') and SpellPowerLevelEqualOrLessThan(context.Observer.ProficiencyBonus)"
data "Properties" "Counterspell()"
data "Cost" "ReactionActionPoint:1"
data "InterruptDefaultValue" "Ask;Enabled"
data "EnableCondition" "not HasStatus('SG_Polymorph') or Tagged('MINDFLAYER') or HasStatus('SG_Disguise')"
data "EnableContext" "OnStatusApplied;OnStatusRemoved"

// 北冥神功
new entry "Passive_KFC_BeiMingShenGong"
type "PassiveData"
// 吸收元素
data "Icon" "PassiveFeature_AbsorbElements"
data "DisplayName" "h86d88fd1g5817g4239gae61gdc97ceabc9a8;1"
data "Description" "h308cec68gda29g40e5gae76g5f53aa842295;1"
data "ExtraDescription" "he57bf83egac0cg46dfga37ag7474c1550ff2;1"
data "ExtraDescriptionParams" "Distance(18)"
data "Properties" "Highlighted"
data "Boosts" "ActionResource(ReactionActionPoint,2,0);UnlockInterrupt(Interrupt_KFC_DampenElements)"

new entry "Interrupt_KFC_DampenElements"
type "InterruptData"
data "Icon" "PassiveFeature_AbsorbElements"
data "DisplayName" "he28bbfbageba6g4004ga271g6d531fc8821b;1"
data "Description" "hecf92689gb3cfg4a80g9c22gf3b6b0f64a4f;1"
data "DescriptionParams" "1d10"
data "InterruptContextScope" "Self"
data "Conditions" "IsAbleToReact(context.Observer) and Self(context.Target,context.Observer) and (SpellDamageTypeIs(DamageType.Acid) or SpellDamageTypeIs(DamageType.Cold) or SpellDamageTypeIs(DamageType.Fire) or SpellDamageTypeIs(DamageType.Lightning) or SpellDamageTypeIs(DamageType.Thunder)) and not AnyEntityIsItem()"
data "Properties" "SetDamageResistance(Acid);SetDamageResistance(Cold);SetDamageResistance(Fire);SetDamageResistance(Lightning);SetDamageResistance(Thunder);ApplyStatus(OBSERVER_TARGET,ABSORB_ELEMENTS_ACTIVE,100,1)"
data "Cost" "ReactionActionPoint:1"
data "Cooldown" "OncePerTurn"
data "EnableCondition" "not HasStatus('SG_Polymorph') and HasActionResource('Interrupt_AbsorbElements',1,0,false,false,context.Source)"
data "EnableContext" "OnActionResourcesChanged"
